{% extends "base.html" %}
{% block title %}所有角色  {% endblock %}

{% block content %}
<style>
	.show_role {
		margin-top:10px;width:300px;height:400px;border:1px solid #eee; float:left; 
		box-shadown : 0 2px 2px rgba(0, 0, 0, 0.2);
		-moz-box-shadow : 0 2px 2px rgba(0, 0, 0, 0.2);
		-webkit-box-shadow : 0 2px 2px rgba(0, 0, 0, 0.2);
	}
	.role_toolbar {
		width:100%;height:30px;  z-index:100; text-align:center;
	}
	.role_resume {
		position:absolute; margin-top:250px; z-index:100; width:90%; background:#fff;
		padding:20px; display: none;
	}
</style>

<div>
	<div class="conr-title">
		<div class="breadcrumb"></div>
		<h2><a href="{% url add_role %}"><img src="{{STATIC_URL}}images/btn_createrole.png" /></a></h2>
	</div>
	<div class="page">
		<div class="role_list">
		{% load replace %}
		{% load islinkuser %}
	 	{% for role in role_list %}
			<div id="role_{{role.id}}" class="show_role" 
			{% if role.image %}
			style="background-image:url(/{{role.image}}); background-repeat: no-repeat; "
			{% else %}
			style="background-image:{{role.profile|cut:"background:"|cut:"\""|replace|join:','}}; background-repeat: no-repeat; "
			{% endif %}
			>
				<div id="role_{{role.id}}_toolbar" class="role_toolbar">
					{% if role.author.id == session.id %}
					<input type="button" value="修改" onclick='window.location.href= "{%url edit_role role.id %}"'/>	
					{% else %}
						{% if role.id|islinkuser:link_role_list %}
						<input type="button" value="取消引用" onclick="unlink_user({{role.id}})"/>
						{% else %}
						<input type="button" id="btn_link_role" value="引用" onclick="link_user({{role.id}})"/>
						{% endif %}	
					{% endif %}	
					<!--input type="button" value="相关角色"/-->
					<input type="button" value="档案" onclick="role_resume({{role.id}})"/>

				</div>
				
				<div id="role_{{role.id}}_resume" class="role_resume">
					
					<p><a href="#">{{role.author}}</a> 的 <a href="#">{{role.relation}}</a></p>
					<p>{{role.birthday}}</p>
					<p>{{role.resume}}</p>
				</div>
			</div>
		 {% endfor %}
		</div>
	</div>
</div>
{% endblock %}

{% block js %}
<script>

$(document).ready(function(){
	var all_role = $('.show_role');
	for ( var i=0; i < all_role.length; i++)
	{
		var degree = Math.round(Math.random()*10);
		if ( degree > 5 )
		degree = -degree;
		$('.show_role').eq(i).css('-o-transform','rotate('+degree+'deg)').css('-webkit-transform','rotate('+degree+'deg)').css('-moz-transform','rotate('+degree+'deg)');
	}
	
	$('.role_list .show_role').mouseover( function (){
		$("#"+this.id+"_toolbar").show();
	}).mouseout( function (){
		$("#"+this.id+"_toolbar").hide();
	});
	
	$("input, button").uniform();
});

function role_resume(rid)
{	
	var role_resume_status = $("#role_"+rid+"_resume").css('display');
	if (role_resume_status == 'none')
		$("#role_"+rid+"_resume").fadeIn();
	else
		$("#role_"+rid+"_resume").fadeOut();
}

function link_user(rid)
{
	$.ajax({
		type : 'GET',
		url: '/role/link/',
		data : {'role_id':rid},
		statusCode : {
			200: function()
			{
				alert ('Add success');
			},
			500: function()
			{
				//$("#link_role_"+role_id).val('Link').parent().prepend('Un');
				alert ('添加失败，是否重复添加？');
			}
		}
	});
}

function unlink_user(rid)
{
	$.ajax({
		type : 'GET',
		url: '/role/unlink/',
		data : {'role_id':rid},
		statusCode : {
			200: function()
			{
				alert ('删除成功');
			}
		}
	});
	window.location.reload();
}
</script>
{% endblock %}