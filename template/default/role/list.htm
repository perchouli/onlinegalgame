<!--{subtemplate common/header}-->
<style>
.role_wapper {
    margin:10px 5px;width:300px;height:400px;border:1px solid #eee; float:left; 
    box-shadow : 0 2px 2px rgba(0, 0, 0, 0.2);
    -moz-box-shadow : 0 2px 2px rgba(0, 0, 0, 0.2);
    -webkit-box-shadow : 0 2px 2px rgba(0, 0, 0, 0.2);
}
.role_toolbar {
    height:30px;  z-index:100;position:absolute; width: 300px;
}

.role_resume {
position:absolute; margin-top:250px; z-index:100; width:260px; background:#fcfcfc;
padding:20px;height: 90px; display: none;
overflow:auto;
}
select { background-color: #fcfcfc; border-color: #eee; margin-top:5px;padding: 3px;border-style: solid;}

</style>

<div>
    <div class="conr-title">
        <h2><a href="role.php?mod=add"><img src="/static/img/btn_createrole.png" /></a></h2>
    </div>
	<br/>
    <div class="page">
        <div class="role_list">
			<!--{if $roles}-->
			<!--{loop $roles $id $role}-->
            <div id="role_<!--{$role[rid]}-->" class="role_wapper" 
            style="background-image:<!--{if $role[aid]}-->url(<!--{$role[img]}-->)<!--{else}-->{{role.profile|cut:'background:'}}<!--{/if}-->;background-repeat:no-repeat;background-position:bottom;">
                <div id="role_<!--{$role[rid]}-->_toolbar" class="role_toolbar">
                    <select onchange="roleChild(<!--{$role[rid]}-->,this.options[this.selectedIndex].title,this.value)" >
                        <option title="<!--{$role[rid]}-->_0" value="<!--{$role[img]}-->"><!--{$role[name]}--></option>
                    <!--{loop $role[posture] $id $rp}-->
                        <option title="<!--{$role[rid]}-->_<!--{$rp[pid]}-->" value="<!--{$rp[img]}-->"><!--{$role[name]}--> - <!--{$rp[name]}--></option>
                    <!--{/loop}-->
                    </select><br/>
					<!--{if $role[uid] == $_G[uid]}-->
                    <input type="button" class="btn btn-primary btn-small" value="<!--{lang edit}-->" onclick="window.location.href='role.php?mod=edit&id=<!--{$role[rid]}-->'"/>
					<input type="button" class="btn btn-primary btn-small" value="<!--{lang delete}-->" onclick="delRole(<!--{$role[rid]}-->)"/>    
                    <!--{else}-->
                        <!--{if $role[link]}-->
                        <input type="button" class="btn btn-primary btn-small" value="<!--{lang unlink}-->" onclick="link_role(<!--{$role[rid]}-->, 'unlink')"/>
                        <!--{else}-->
                        <!--{if !$role[private]}-->
                        <input type="button" class="btn btn-primary btn-small" id="btn_link_role" value="<!--{lang link}-->" onclick="link_role(<!--{$role[rid]}-->,'link')"/>
                        <!--{/if}-->
                        <!--{/if}-->
                    <!--{/if}-->
                    <input type="button" class="btn btn-primary btn-small" value="<!--{lang resume}-->" onclick="roleResume(<!--{$role[rid]}-->)"/>
                </div>

                <div id="role_<!--{$role[rid]}-->_resume" class="role_resume">
                    <h3><a href="role.php?mod=show&id=<!--{$role[rid]}-->"><!--{$role[name]}--></a></h3>
                    <p><a href="account.php?mod=profile&id=<!--{$role[uid]}-->" target="_blank">@<!--{$role[username]}--></a> 制作的<span style="color:#7BCA1C">角色</span></p>
                    <p>属性: <!--{if $role[tag]}--><!--{loop $role[tag] $idt $tag}--><a href="role.php?mod=list&tag=<!--{$tag[name]}-->" style="text-decoration: underline;"><!--{$tag[name]}--></a> <!--{/loop}--><!--{else}-->无<!--{/if}--></p>
                    <p>简介: <!--{$role[description]}--></p>
                </div>
            </div>
			<!--{/loop}-->
			<!--{else}-->
			<p>没有找到角色</p>
			<!--{/if}-->
        </div>
		<div class="clear"></div>
		<!--{subtemplate common/pagination}-->
    </div>
</div>

<script>
$(document).ready(function(){
});
/**
 * 显示用户资料
 * @param {Number} rid
 */
function roleResume(rid){    
    var s = $("#role_"+rid+"_resume").css('display');
    if (s == 'none')
        $("#role_"+rid+"_resume").fadeIn();
    else
        $("#role_"+rid+"_resume").fadeOut();
}

function roleChild(pid,cid,v){
    //$("#role_"+pid+"_toolbar").find('input[value="编辑"]').attr('onclick',"window.location.href='role.php?mod=edit&id="+cid+"'");
    if ( v.indexOf('/data/attach') == -1){
        $("#role_"+pid).attr('style','background-image:'+v);
    }else{
        $("#role_"+pid).attr('style',"background-image:url('"+v+"');background-repeat:no-repeat;background-position:center bottom;");
    }
}

/**
 * 引用/取消引用角色
 * @param {int} rid
 * @param {link/unlink} action
 */
function link_role(rid, action){
    <!--{if $_G[uid]}-->
    if (action == 'link'){
        $.ajax({
            type : 'GET',
            url: 'role.php?mod=link',
            data : {'id':rid},
			success: function(data, textStatus){
				if (data == '0') {
					jRight ('引用成功，现在您可以在自己的<a href="story.php?mod=list">剧本</a>中使用这个人物了！','成功');
				} else {
					jAlert ('引用失败，是否重复引用？','错误');
				}
			}
        });
    } else if (action == 'unlink') {
        $.ajax({
            type: 'GET',
            url: 'role.php?mod=link&do=del',
            data: {'id':rid},
			success: function(data, textStatus){
				if (data == '0') {
					jRight ('取消引用成功！', '成功',function(){window.location.reload();});
				} else {
					jAlert ('取消引用失败，是否引用过？','错误');
				}
			}
        });
    }
    <!--{else}-->
    location.href = 'account.php?mod=signin&url=role.php%3Fmod=list&t={TIMESTAMP}';
    <!--{/if}-->
}

function delRole(rid){
	jConfirm('删除后的角色不能再恢复，确认要删除吗？', 'Confirmation Dialog', function(r) {
		if (r){
			$.ajax({
				type: 'POST',
				url: 'role.php?mod=del&ajax=1',
				dataType:'json',
				data: {'id':rid},
				success: function(msg){
					if (msg == '0') {
						window.location.href = 'role.php?mod=list';
					} else {
						jAlert('删除角色失败！', 'Submit Failed');
					}
				}
			});
		}
   });
}
</script>

<!--{subtemplate common/footer}-->